A daily log of changes and commentary. An experiment of sorts.

2020-07-05 Sun

Link to the commit on pre-release and daily build pages.

Fixed a long-standing issue of loosing list of opened files
if Sumatra crashes or get killed by Windows (e.g. due to restart).
Took so long to fix becaue I believed the code is correct.
Turns out prefs::Save() was haphzardly used. It's still
not great but at least this specific error is fixed.
To be even more robust we should periodically (every 5 min?)
call prefs::Save(). We only do it after opening and closing a file,
which means that if we scroll etc., we'll loose this info.

Coding style refactorings: change enum SettingType to enum class,
change SerializeStruct() and SerializeGlobalPrefs() to return std::span<u8>.

Fixed https://github.com/sumatrapdfreader/sumatrapdf/issues/1661
Another example of broken PDF that can be better handled if we
relax parsing of PDF (cmap).

Fixed https://github.com/sumatrapdfreader/sumatrapdf/issues/651
Managing focus is tricky.

2020-07-04 Sat

Improving WStr the same way as Str, while we're in this area.

make ByteWriter manage it's own buffer. In retrospect it's
better API than passing a buffer.

2020-07-03 Fri

De-templetizing WStr implementation. Currently it's a subclass
of Vec<WCHAR>.
Yes, duplication of code is bad but so are templates.
Reading code where you see T instead of WCHAR is significantly
worse.
The more stuff there is in .h files, the more code uses
templates, the longer are compilation times.
Templated code must be in .h file. 
While I can't fix long compilation times, I can try to keep
them as fast as possible.
Also an opportunity to make the API smaller.

Optimized str::Str on 64-bit by changing type of len/cap from
size_t to u32.

---

Optimizing Str. Turns out that after de-templatizing the code
became easier to understand and opportunities for optimizations
turn up.
The optimizations are pretty nasty (re-using the same memory for
more than one purpse) but worth doing for such a fundamental type.

2020-06-29 Mon

- adding comments to Commands.h
- website: add 'Spread the word' section
- refactor: use DirIter in EngineImageDir::LoadImageDir()

